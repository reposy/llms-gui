# Input 노드

### 1. 개요

`Input` 노드는 워크플로우의 시작점이 되거나 다른 노드로부터 데이터를 받아 저장하고, 후속 처리를 위한 실행 방식을 제어하는 **프론트엔드 기반 노드**입니다. 사용자가 직접 텍스트나 파일을 입력할 수 있으며, **공통 항목(Shared Items)**과 **개별 항목(Individual Items)**을 구분하여 관리하는 기능을 통해 복잡한 데이터 처리 시나리오를 지원합니다.

### 2. 주요 기능 및 UI (`components/nodes/InputNode.tsx`, `InputNodeConfig.tsx`)

*   **데이터 입력:**
    *   텍스트나 파일을 **공통 항목** 또는 **개별 항목**으로 직접 추가할 수 있습니다. (UI에 각 항목 유형별 추가 버튼 제공)
    *   이전 노드로부터 받은 출력을 업데이트 모드 설정에 따라 공통 또는 개별 항목으로 자동 추가할 수 있습니다.
*   **항목 유형 관리:**
    *   **공통 항목(Shared Items):** ForEach 모드에서 모든 개별 항목 처리 시 함께 사용될 데이터입니다. (예: 공통 프롬프트, 설정 값, 참조 이미지)
    *   **개별 항목(Individual Items):** ForEach 모드에서 각각 독립적으로 처리될 데이터입니다. (예: 처리할 이미지 목록, 번역할 텍스트 목록)
*   **실행 모드 (`iterateEachRow`):**
    *   UI에서 Batch 모드와 ForEach 모드를 토글하여 전환합니다.
    *   **Batch 모드 (`iterateEachRow: false`):** 모든 공통 항목과 개별 항목을 하나의 배열로 결합하여 다음 노드에 전달합니다.
    *   **ForEach 모드 (`iterateEachRow: true`):** 각 개별 항목마다 모든 공통 항목과 결합하여 다음 노드를 실행합니다. (개별 항목 수만큼 실행)
*   **업데이트 모드 (`updateMode`):**
    *   UI에서 이전 노드 출력을 어떻게 처리할지 (`공통 항목`, `개별 항목`, `미적용`) 선택합니다.
    *   `shared`: 출력을 공통 항목에 추가합니다.
    *   `element`: 출력을 개별 항목에 추가합니다.
    *   `none`: 출력을 저장하지 않습니다.
*   **항목 관리 UI:**
    *   공통 항목과 개별 항목 목록을 UI 상에서 명확하게 분리하여 시각적으로 표시합니다.
    *   각 항목 유형별 또는 전체 항목을 비우는 버튼을 제공합니다.

### 3. 실행 로직 (`core/InputNode.ts`)

1.  `execute` 메서드가 호출됩니다.
2.  현재 저장된 공통 항목(`sharedItems`), 개별 항목(`items`), 업데이트 모드(`updateMode`), 실행 모드(`iterateEachRow`) 설정을 가져옵니다. (이 값들은 `useNodeContentStore` 등을 통해 관리될 수 있습니다.)
3.  이전 노드로부터 입력(`input`)이 있고 업데이트 모드가 `none`이 아니면:
    *   `updateMode`가 `shared`인 경우: 유효한 입력을 `sharedItems` 배열에 추가합니다.
    *   `updateMode`가 `element`인 경우: 유효한 입력을 `items` 배열에 추가합니다.
    *   상태 저장소(`useNodeContentStore` 또는 유사 스토어)에 업데이트된 배열을 저장합니다.
4.  `iterateEachRow` 값에 따라 후속 처리를 결정합니다:
    *   **`false` (Batch 모드):**
        *   공통 항목과 개별 항목을 하나의 배열로 결합합니다: `[...sharedItems, ...items]`.
        *   이 결합된 배열을 반환하여 다음 노드의 입력으로 사용합니다.
    *   **`true` (ForEach 모드):**
        *   `items` 배열 (개별 항목)의 각 `item`에 대해 반복합니다.
        *   각 반복에서 `[...sharedItems, item]` (모든 공통 항목 + 현재 개별 항목) 형태의 배열을 생성합니다.
        *   이 생성된 배열을 입력으로 사용하여 연결된 모든 자식 노드의 `process()` 메서드를 호출합니다. 즉, 각 자식 노드는 각 (공통항목 + 개별항목) 조합에 대해 실행됩니다.
        *   모든 항목에 대한 반복이 끝나면 `null`을 반환하여, Input 노드 다음으로의 직접적인 단일 체이닝을 중단시킵니다. (실행 흐름은 각 항목에 대해 분기되어 진행됨)

### 4. 백엔드 상호작용 및 역할

-   Input 노드는 데이터를 저장하고 실행 모드를 제어하는 **프론트엔드 기반 노드**이며, 백엔드와 직접 상호작용하지 않습니다.
-   파일 입력 시 `File` 객체는 브라우저 메모리에 저장됩니다. (대용량 파일 처리에 대한 고려가 필요할 수 있음)

### 5. 데이터 흐름 및 출력 형식

-   **입력:** Any 타입 (이전 노드의 출력, 선택적).
-   **처리:** 프론트엔드 상태 저장소에 데이터(공통/개별 항목) 저장 및 실행 모드 결정.
-   **출력:**
    -   **Batch 모드 (`iterateEachRow: false`):** 공통 항목과 개별 항목을 모두 포함하는 **배열 (Array)**.
    -   **ForEach 모드 (`iterateEachRow: true`):** 다음 노드로 직접 전달되는 단일 출력은 **없음 (`null`)**. 대신 각 (공통항목 + 개별항목) 조합이 후속 노드들의 입력으로 사용되어 여러 번의 실행을 유발함.

**참고:** `OLD_NODES.md`의 Input 노드 설명 중 실행 로직 부분이 다소 혼재되어 있어, `Batch` 모드와 `ForEach` 모드의 동작 및 `sharedItems`의 역할을 명확히 구분하여 재정리했습니다. `ForEach` 모드는 주로 `Group` 노드의 `Iteration Config`에서 데이터 소스로 지정되어, 그룹 내의 워크플로우를 각 항목에 대해 반복 실행하는 데 사용될 수 있습니다. 